import{K as E,g as G,r as d,a6 as L,ag as S,f as A,i as M,j as s,bd as g,P as h,B as P,be as R}from"./index-e8a81011.js";import{L as p}from"./logo-loader-b4e52445.js";function T(){const{chatId:r,inviteCode:o}=E(),{profile:e}=G(),f=["Joining Group Chat...","Redirecting to Group Chat..."],[j,y]=d.useState(0),{socket:n}=L(),[v,i]=d.useState(!1),{setActiveChat:I}=S(),b=A(),{isError:k,mutateAsync:c,isPending:C}=M({method:"post",route:"/join-via-link",displayToast:!1,noToken:!0}),N=async()=>{var u,x,l;if(!C)try{const a=await c({inviteCode:o??"",userId:(e==null?void 0:e.id)??"",chatId:r??""});console.log("the response : ",a);const t=(u=a.data)==null?void 0:u.groupChat,m=(x=a.data)==null?void 0:x.joinedMessage;if(!t||!m){i(!0);return}n==null||n.emit("joinChat",{userId:e==null?void 0:e.id,chatId:t==null?void 0:t.id}),n==null||n.emit("sendMessage",{chatInfo:t,message:m}),I({dmInfo:null,groupInfo:{...t,name:(t==null?void 0:t.name)??null,isGroup:!0}}),y(1),setTimeout(()=>{b(`/${e==null?void 0:e.id}/chats`)},1e3)}catch(a){a instanceof R&&((l=a==null?void 0:a.response)==null?void 0:l.status)===404&&i(!0)}};return d.useEffect(()=>{if(!(e!=null&&e.id)||!r||!o){i(!0);return}N()},[r,o,e==null?void 0:e.id]),v?s.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-background",children:[s.jsx(g,{className:"text-4xl font-bold mb-4 text-gray-800 dark:text-gray-200",children:"404"}),s.jsx(h,{className:"text-lg text-gray-600 dark:text-gray-400",children:"Group Chat not found"})]}):k?s.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-background",children:[s.jsx(g,{className:"text-2xl font-bold mb-4 text-gray-800 dark:text-gray-200",children:"Failed to join Group Chat"}),s.jsx(P,{onClick:()=>c({inviteCode:o??"",userId:(e==null?void 0:e.id)??"",chatId:r??""}),className:"mt-4",children:"Retry"})]}):s.jsx("div",{children:s.jsx(p,{children:s.jsx(h,{className:"text-lg text-gray-600 dark:text-gray-400",children:f[j]})})})}export{T as default};
