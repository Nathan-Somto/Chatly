import{b4 as B,c as G,b5 as H,b6 as N,e as E,f as T,r as f,g as M,b7 as V,i as L,j as a,ak as $,B as C,b8 as q,b9 as K,ba as Q,n as _,af as O,aE as J,ai as W,bb as X,P as F,a9 as Y,bc as Z,aA as ee}from"./index-d8866171.js";import{L as se}from"./logo-loader-7d8003e8.js";function ae(){const n=B();return n===void 0?{isLoaded:!1,isSignedIn:void 0,user:void 0}:n===null?{isLoaded:!0,isSignedIn:!1,user:null}:{isLoaded:!0,isSignedIn:!0,user:n}}const re=G("ImagePlus",[["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7",key:"31hg93"}],["line",{x1:"16",x2:"22",y1:"5",y2:"5",key:"ez7e4s"}],["line",{x1:"19",x2:"19",y1:"2",y2:"8",key:"1gkr8c"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),te=H({username:N().min(5).max(40),bio:N().min(10).max(500),avatar:N()});function ie({username:n,bio:g,avatar:p,id:v,clerkId:o,email:t}){const{theme:w}=E(),l=T(),i=f.useRef(null),{setProfile:I}=M(),[k,e]=f.useState(""),[x,u]=f.useState(!1),{handleSubmit:h,register:c,formState:{errors:d}}=V({resolver:Q(te),defaultValues:{username:n,bio:g,avatar:p}});function m(r){console.log("response: ",r);const s=r.data.user;I({avatar:s.avatar,bio:s.bio,clerkId:s.clerkId,email:s.email,id:s.id,isOnboarded:s.isOnboarded,username:s.username,wallpaperType:s==null?void 0:s.wallpaperType,wallpaperUrl:s==null?void 0:s.wallpaperUrl}),l(`/${s.clerkId}/chats`),console.log(r)}const{mutate:b,isPending:y}=L({defaultMessage:"Failed to create user profile!",method:"post",route:"/users",onSuccess:m}),{mutate:j,isPending:D}=L({defaultMessage:"Failed to create user profile!",method:"patch",route:"/users",onSuccess:m});async function R(r){u(!0);try{if(k&&i.current&&i.current.files){console.log("the file: ",i.current.files[0]);const s=await _(i.current.files[0]);s&&(r.avatar=s)}u(!1),console.log("on submit data: ",r),v===""?b({...r,email:t,clerkId:o,theme:w,isOnboarded:!0}):j({...r,email:t,clerkId:o,isOnboarded:!0})}catch(s){O.error(J(s,"failed to create user profile!"))}}const P=y||D||x;function z(r){r.preventDefault();const s=new FileReader;if(r.target.files&&r.target.files.length>0){if(!r.target.files[0].type.includes("image")){O.error("only image files are allowed!");return}s.onload=async S=>{var U,A;e(((A=(U=S==null?void 0:S.target)==null?void 0:U.result)==null?void 0:A.toString())??"")},s.readAsDataURL(r.target.files[0])}}return a.jsxs("form",{className:"space-y-4 text-sm md:text-lg",onSubmit:h(R),children:[a.jsxs("figure",{className:"flex items-center gap-2 mx-auto relative h-24 w-24 text-sm flex-wrap justify-center flex-shrink-0",children:[a.jsx($,{type:"User",src:k||p,alt:"avatar preview",size:96,className:"ring-brand-p2 ring-2"}),a.jsxs(C,{type:"button",className:"absolute -bottom-2 h-9 w-9 z-[3] right-0",variant:"outline",onClick:()=>{var r;return(r=i.current)==null?void 0:r.click()},children:[a.jsx(re,{className:"h-6 w-6 flex-shrink-0"}),a.jsx("span",{className:"sr-only",children:"Upload Image"})]}),a.jsx("input",{type:"file",id:"avatar",name:"avatar",onChange:z,accept:"image/*",hidden:!0,ref:i,max:1})]}),a.jsx(q,{errors:d,id:"username",label:"username",register:c,type:"text"}),a.jsx(K,{errors:d,id:"bio",label:"bio",height:30,width:30,register:c,className:"w-full h-[100px]"}),a.jsx(C,{className:"min-w-full text-gray-100",size:"lg",disabled:P,children:P?"Creating...":"Save"})]})}function oe(){const{setProfile:n}=M(),[g,p]=f.useState(null),v=T(),{isSignedIn:o,user:t,isLoaded:w}=ae(),{data:l,isPending:i,isError:I,refetch:k}=W({enabled:o??!1,queryKey:["onboarding"],route:"/users/profile",displayToast:!1});return f.useEffect(()=>{var x,u,h,c,d,m,b,y;const e=l==null?void 0:l.data;if(e&&t){console.log(e);const j={username:((x=e==null?void 0:e.user)==null?void 0:x.username)??X(t.firstName??t.emailAddresses[0].emailAddress.split("@")[0]??""),bio:((u=e==null?void 0:e.user)==null?void 0:u.bio)??"i just joined chatly!",avatar:((h=e==null?void 0:e.user)==null?void 0:h.avatar)??t.imageUrl,id:((c=e==null?void 0:e.user)==null?void 0:c.id)??"",clerkId:t.id,isOnboarded:((d=e==null?void 0:e.user)==null?void 0:d.isOnboarded)??!1,email:((m=e==null?void 0:e.user)==null?void 0:m.email)??t.emailAddresses[0].emailAddress};n(j),(b=e==null?void 0:e.user)!=null&&b.isOnboarded?v(`/${(y=e==null?void 0:e.user)==null?void 0:y.id}/chats`):p(j)}},[l,t]),!o||!w?a.jsx(se,{children:a.jsx(F,{className:"text-center text-lg text-brand-p1 font-semibold mt-2",children:"Checking Authentication Status..."})}):i?a.jsx(Y,{}):a.jsxs("div",{className:"min-h-screen w-full  pb-8",children:[a.jsx(Z,{}),a.jsxs("main",{className:"max-w-[550px] sm:w-full w-[90%] mt-24 min-h-[400px] py-7 rounded-lg bg-gray-50 dark:bg-[#17191C] ring-2 ring-[#ddd]/80 dark:ring-gray-500/80 px-8 mx-auto",children:[a.jsxs("div",{className:"mb-8  space-y-3",children:[a.jsx(ee,{className:"text-4xl",children:"Set Up Profile"}),a.jsx(F,{children:"Complete your profile by filling this form"})]}),g!==null&&a.jsx(ie,{...g})]})]})}export{oe as default};
